<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Supervised Learning - Python to AI</title>
	<meta name="description" content="Supervised Machine Learning projects: Crime Prediction and Census Income Classification.">
	<meta name="author" content="Ishani Kathuria">

	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>

	<!-- FontAwesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">

	<!-- ONNX Runtime Web -->
	<script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.3/dist/ort.min.js"></script>

	<style type="text/tailwindcss">
		body {
            font-family: 'Nunito', sans-serif;
        }

        .nav-link {
            @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 transition-colors cursor-pointer;
        }

        .nav-link.active {
            @apply text-indigo-700 bg-indigo-50 font-bold;
        }

        .section-container {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12;
        }

        .card {
            @apply bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">

	<!-- NAVIGATION -->
	<nav class="bg-white shadow-sm sticky top-0 z-50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="flex justify-between h-16">
				<div class="flex">
					<div class="flex-shrink-0 flex items-center">
						<i class="fa-solid fa-code fa-2x text-indigo-600"></i>
						<span class="ml-2 font-bold text-xl text-gray-800">Python to AI</span>
					</div>
					<div class="hidden sm:ml-6 sm:flex sm:space-x-4 items-center">
						<a href="../../index.html" class="nav-link">Home</a>
						<a href="supervised_learning.html" class="nav-link active">Supervised ML</a>
						<a href="unsupervised_learning.html" class="nav-link">Unsupervised ML</a>
						<a href="deep_learning.html" class="nav-link">Deep Learning</a>
					</div>
				</div>
				<div class="flex items-center">
					<a href="https://github.com/ikathuria" target="_blank" class="text-gray-400 hover:text-gray-600 mx-2"><i class="fa-brands fa-github fa-lg"></i></a>
					<a href="https://linkedin.com/in/ishani-kathuria/" target="_blank" class="text-gray-400 hover:text-blue-600 mx-2"><i class="fa-brands fa-linkedin fa-lg"></i></a>
					<a href="https://medium.com/@ishani-kathuria" target="_blank" class="text-gray-400 hover:text-black mx-2"><i class="fa-brands fa-medium fa-lg"></i></a>
				</div>
			</div>
		</div>
		<!-- Mobile Menu (Simple) -->
		<div class="sm:hidden border-t border-gray-200 bg-gray-50">
			<div class="flex flex-col space-y-1 px-4 py-2">
				<a href="../../index.html" class="block py-2 text-base font-medium text-gray-700 hover:text-indigo-600">Home</a>
				<a href="supervised_learning.html" class="block py-2 text-base font-medium text-gray-700 hover:text-indigo-600 font-bold bg-indigo-50 text-indigo-700">Supervised</a>
				<a href="unsupervised_learning.html" class="block py-2 text-base font-medium text-gray-700 hover:text-indigo-600">Unsupervised</a>
				<a href="deep_learning.html" class="block py-2 text-base font-medium text-gray-700 hover:text-indigo-600">Deep Learning</a>
			</div>
		</div>
	</nav>

	<!-- CONTENT SECTIONS -->
	<main class="flex-grow">

		<!-- === SUPERVISED ML SECTION === -->
		<section id="supervised-section" class="section-container">
			<h2 class="text-3xl font-bold text-gray-900 mb-8 pb-2 border-b">Supervised Machine Learning</h2>

			<div class="grid grid-cols-1 md:grid-cols-12 gap-8">
				<!-- Sidebar: Project Selector -->
				<div class="md:col-span-3 space-y-2">
					<button onclick="showSupervisedProject('crime')" id="btn-crime" class="w-full text-left px-4 py-3 rounded-lg bg-indigo-50 text-indigo-700 font-semibold border-l-4 border-indigo-600 shadow-sm transition-all hover:bg-indigo-100">
						<i class="fa-solid fa-gavel mr-2"></i> Crime Prediction
					</button>
					<button onclick="showSupervisedProject('census')" id="btn-census" class="w-full text-left px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-l-4 border-transparent transition-all">
						<i class="fa-solid fa-users mr-2"></i> Census Income
					</button>
					<div class="pt-4 text-xs text-gray-400 uppercase tracking-widest font-semibold">Algorithms</div>
					<ul class="space-y-1 text-sm text-gray-500 pl-4">
						<li>Naive Bayes</li>
						<li>K-Nearest Neighbors</li>
						<li>Logistic Regression</li>
						<li>Decision Trees</li>
					</ul>
				</div>

				<!-- Main Content Area -->
				<div class="md:col-span-9">

					<!-- CRIME PREDICTION MODEL (Interactive) -->
					<div id="project-crime" class="space-y-6">
						<div class="bg-indigo-600 text-white p-6 rounded-xl shadow-lg">
							<h3 class="text-2xl font-bold mb-2">Chicago Crime Predictor <span class="bg-white text-indigo-600 text-xs px-2 py-1 rounded ml-2 uppercase">Live ONNX Demo</span></h3>
							<p class="opacity-90">Predicts prediction of an arrest or forecasts crime counts based on location and time data using a trained Neural Network (MLP) deployed in the browser.</p>
						</div>

						<!-- ORIGINAL INPUT FORM INTEGRATION -->
						<div class="card p-6 sm:p-8">
							<!-- Model Controls -->
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
								<div>
									<label for="predictionTypeSelector" class="block text-sm font-semibold text-gray-700 mb-2">1. Prediction Task</label>
									<select id="predictionTypeSelector" onchange="updatePredictionType()" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
										<option value="CLASSIFICATION">Binary Classification (Predict Arrest)</option>
										<option value="REGRESSION">Regression (Forecast Crime Count)</option>
									</select>
								</div>
								<div>
									<label for="modelSelector" class="block text-sm font-semibold text-gray-700 mb-2">2. Model Architecture</label>
									<select id="modelSelector" onchange="loadModel()" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-indigo-500 focus:border-indigo-500">
										<!-- Populated via JS -->
									</select>
								</div>
							</div>

							<!-- Inputs -->
							<h4 class="text-lg font-semibold text-gray-800 mb-3">3. Features</h4>
							<div id="inputFormContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
								<!-- Dynamic Inputs -->
							</div>

							<!-- Button -->
							<button onclick="runPrediction()" id="predictBtn" class="w-full mt-6 bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition transform hover:scale-[1.01] shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
								Loading Model...
							</button>

							<!-- Output -->
							<div id="output" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
								<h4 class="text-lg font-bold text-green-800">Prediction Result</h4>
								<div id="resultText" class="text-xl mt-1"></div>
								<div id="confidence" class="text-sm text-gray-600 mt-1"></div>
							</div>
							<div id="loading" class="mt-6 p-4 bg-blue-50 text-blue-800 rounded-lg hidden animate-pulse">
								Processing...
							</div>
						</div>
					</div>

					<!-- CENSUS INCOME PREDICTION (ONNX UI) -->
					<div id="project-census" class="space-y-6 hidden">
						<div class="bg-gray-800 text-white p-6 rounded-xl shadow-lg relative overflow-hidden">
							<div class="absolute top-2 right-2 text-xs bg-green-500 text-white font-bold px-2 py-1 rounded">ONNX Enabled</div>
							<h3 class="text-2xl font-bold mb-2">Census Income Prediction</h3>
							<p class="opacity-80">Classifies whether income exceeds $50K/yr based on census data using Naive Bayes (Browser-side).</p>
						</div>

						<div class="card p-6">
							<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
								<div><label class="block text-xs font-bold text-gray-500">Age</label><input type="number" id="census-age" value="39" class="w-full border p-2 rounded"></div>
								<div><label class="block text-xs font-bold text-gray-500">Workclass</label><select id="census-workclass" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Education</label><select id="census-education" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Marital Status</label><select id="census-marital_status" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Occupation</label><select id="census-occupation" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Relationship</label><select id="census-relationship" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Race</label><select id="census-race" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Gender</label><select id="census-gender" class="w-full border p-2 rounded"></select></div>
								<div><label class="block text-xs font-bold text-gray-500">Capital Gain</label><input type="number" id="census-capital_gain" value="0" class="w-full border p-2 rounded"></div>
								<div><label class="block text-xs font-bold text-gray-500">Capital Loss</label><input type="number" id="census-capital_loss" value="0" class="w-full border p-2 rounded"></div>
								<div><label class="block text-xs font-bold text-gray-500">Hours/Week</label><input type="number" id="census-hours" value="40" class="w-full border p-2 rounded"></div>
								<div><label class="block text-xs font-bold text-gray-500">Native Country</label><select id="census-native_country" class="w-full border p-2 rounded"></select></div>
							</div>

							<button onclick="runCensusPrediction()" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded transition">
								Predict Income
							</button>

							<div id="census-result" class="mt-4 p-4 bg-gray-100 rounded text-center text-xl hidden"></div>
						</div>
					</div>

				</div>
			</div>
		</section>

	</main>

	<!-- FOOTER -->
	<footer class="bg-gray-800 text-white py-8 mt-12">
		<div class="max-w-7xl mx-auto px-4 text-center">
			<p class="mb-4">Designed & Built by Ishani Kathuria</p>
			<div class="flex justify-center space-x-6 text-2xl">
				<a href="https://github.com/ikathuria" class="hover:text-indigo-400 transition"><i class="fa-brands fa-github"></i></a>
				<a href="https://linkedin.com/in/ishani-kathuria/" class="hover:text-blue-400 transition"><i class="fa-brands fa-linkedin"></i></a>
			</div>
			<p class="text-gray-500 text-sm mt-4">&copy; 2025 Python to AI.</p>
		</div>
	</footer>

	<!-- JAVASCRIPT LOGIC -->
	<script>
		function showSupervisedProject(projectId) {
			// Toggle sidebar buttons
			document.getElementById('btn-crime').classList.remove('bg-indigo-50', 'text-indigo-700', 'font-semibold', 'border-indigo-600', 'shadow-sm');
			document.getElementById('btn-crime').classList.add('text-gray-600', 'border-transparent');

			document.getElementById('btn-census').classList.remove('bg-indigo-50', 'text-indigo-700', 'font-semibold', 'border-indigo-600', 'shadow-sm');
			document.getElementById('btn-census').classList.add('text-gray-600', 'border-transparent');

			// Apply style to active
			const activeBtn = document.getElementById(`btn-${projectId}`);
			if (activeBtn) {
				activeBtn.classList.add('bg-indigo-50', 'text-indigo-700', 'font-semibold', 'border-indigo-600', 'shadow-sm');
				activeBtn.classList.remove('text-gray-600', 'border-transparent');
			}

			// Toggle Content
			document.getElementById('project-crime').classList.add('hidden');
			document.getElementById('project-census').classList.add('hidden');
			const projectDiv = document.getElementById(`project-${projectId}`);
			if (projectDiv) projectDiv.classList.remove('hidden');
		}


		// --- CRIME PREDICTION MODEL LOGIC ---

		const NORM_CONSTANTS = {
			CLASSIFICATION: {
				INPUT_DIM: 15,
				X_MEANS: new Float32Array([18435, 14.835, 115.36, 0.1966, 1148.9, 11.260, 23.228, 36.587, 11.047, 2021.0, 41.844, -87.670, 12.932, 2.972, 6.619]),
				X_DEVIATIONS: new Float32Array([11375, 12.067, 59.395, 0.39753, 702.12, 7.016, 13.978, 21.535, 5.8643, 2.0642, 0.0879, 0.0592, 6.0050, 2.0050, 3.3636]),
			},
			REGRESSION: {
				INPUT_DIM: 55,
				X_MEANS: new Float32Array([2.9716, 6.6190, 2021.0, 41.844, -87.670, ...new Array(50).fill(0).map((_, i) => i < 5 ? [0.0179, 0.0187, 0.0280, 0.0267, 0.0243][i] : 0)]),
				X_DEVIATIONS: new Float32Array([2.0050, 3.3636, 2.0609, 0.0879, 0.0592, ...new Array(50).fill(1).map((_, i) => i < 5 ? [0.1329, 0.1357, 0.1653, 0.1614, 0.1543][i] : 1)]),
			}
		};

		const MODEL_OPTIONS = {
			CLASSIFICATION: [
				{ value: "../.resources/onnx_models/MLP_Model_Classification.onnx", text: "MLP Model (Shallow)" },
				{ value: "../.resources/onnx_models/DL_Model_Classification.onnx", text: "DL Model (Deep Learning)" }
			],
			REGRESSION: [
				{ value: "../.resources/onnx_models/linreg_model_Regression.onnx", text: "LinRegNet Model" },
				{ value: "../.resources/onnx_models/mlp_model_Regression.onnx", text: "MLPNet Model" },
				{ value: "../.resources/onnx_models/dl_model_Regression.onnx", text: "DLNet Model" },
				{ value: "../.resources/onnx_models/mix_model_Regression.onnx", text: "Linear+NonLinear Model" }
			]
		};

		const CLASSIFICATION_FEATURES = [
			{ id: 'block', name: 'Block (Code)', type: 'number', default: 18435 },
			{ id: 'primaryType', name: 'Primary Type (Code)', type: 'number', default: 14 },
			{ id: 'locationDesc', name: 'Location Desc. (Code)', type: 'number', default: 17 },
			{ id: 'domestic', name: 'Domestic (0/1)', type: 'number', default: 0, min: 0, max: 1 },
			{ id: 'beat', name: 'Beat', type: 'number', default: 1148 },
			{ id: 'district', name: 'District', type: 'number', default: 11 },
			{ id: 'ward', name: 'Ward', type: 'number', default: 23 },
			{ id: 'communityArea', name: 'Community Area', type: 'number', default: 36 },
			{ id: 'fbiCode', name: 'FBI Code (Code)', type: 'number', default: 10 },
			{ id: 'year', name: 'Year', type: 'number', default: 2025 },
			{ id: 'latitude', name: 'Latitude', type: 'number', default: 41.8787, step: 'any' },
			{ id: 'longitude', name: 'Longitude', type: 'number', default: -87.6508, step: 'any' },
			{ id: 'hour', name: 'Hour', type: 'number', default: 0, min: 0, max: 23 },
			{ id: 'day', name: 'Day (Code 0-6)', type: 'number', default: 6, min: 0, max: 6 },
			{ id: 'month', name: 'Month', type: 'number', default: 1, min: 1, max: 12 },
		];

		const REGRESSION_CORE_FEATURES = [
			{ id: 'day', name: 'Day (Code 0-6)', type: 'number', default: 6, min: 0, max: 6 },
			{ id: 'month', name: 'Month', type: 'number', default: 1, min: 1, max: 12 },
			{ id: 'year', name: 'Year', type: 'number', default: 2025 },
			{ id: 'latitude', name: 'Latitude', type: 'number', default: 41.8787, step: 'any' },
			{ id: 'longitude', name: 'Longitude', type: 'number', default: -87.6508, step: 'any' },
			{ id: 'ward', name: 'Ward (1-50)', type: 'number', default: 23, min: 1, max: 50 },
		];

		let session = null;
		let isModelLoaded = false;
		let currentTask = 'CLASSIFICATION';

		function updatePredictionType() {
			const typeSelector = document.getElementById('predictionTypeSelector');
			const modelSelector = document.getElementById('modelSelector');
			currentTask = typeSelector.value;

			// Update Models
			const models = MODEL_OPTIONS[currentTask];
			modelSelector.innerHTML = models.map(m => `<option value="${m.value}">${m.text}</option>`).join('');

			// Update Inputs
			updateInputForm();

			loadModel();
		}

		function updateInputForm() {
			const features = currentTask === 'CLASSIFICATION' ? CLASSIFICATION_FEATURES : REGRESSION_CORE_FEATURES;
			const container = document.getElementById('inputFormContainer');

			let html = '';
			features.forEach(f => {
				html += `
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">${f.name}</label>
                        <input type="${f.type}" id="${f.id}" value="${f.default}" 
                            ${f.step ? `step="${f.step}"` : ''}
                            ${f.min !== undefined ? `min="${f.min}"` : ''}
                            ${f.max !== undefined ? `max="${f.max}"` : ''}
                            class="block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm border focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                `;
			});
			container.innerHTML = html;
		}

		async function loadModel() {
			const modelSelector = document.getElementById('modelSelector');
			const predictBtn = document.getElementById('predictBtn');
			const loadingDiv = document.getElementById('loading');
			const outputDiv = document.getElementById('output');

			let modelPath = modelSelector.value;

			// Path fixes handled in MODEL_OPTIONS, usually this check is not needed if paths are correct
			// But let's keep it robust just in case
			if (modelPath.startsWith('app/')) {
				modelPath = '../' + modelPath.substring(4); // Convert app/ to ../
			}

			isModelLoaded = false;
			predictBtn.disabled = true;
			loadingDiv.classList.remove('hidden');
			loadingDiv.innerHTML = `Loading model...`;
			outputDiv.classList.add('hidden');

			try {
				if (session) { session.release(); session = null; }
				session = await ort.InferenceSession.create(modelPath);
				isModelLoaded = true;
				predictBtn.disabled = false;
				predictBtn.textContent = `Run Prediction`;
				loadingDiv.classList.add('hidden');
			} catch (e) {
				loadingDiv.innerHTML = `<span class="text-red-700 font-bold">Error:</span> ${e.message}. <br>Path: ${modelPath}`;
				loadingDiv.classList.remove('hidden');
				console.error("Model Load Error:", e);
			}
		}

		async function runPrediction() {
			if (!isModelLoaded) { await loadModel(); return; }

			const loadingDiv = document.getElementById('loading');
			const outputDiv = document.getElementById('output');

			outputDiv.classList.add('hidden');
			loadingDiv.classList.remove('hidden');
			loadingDiv.textContent = "Predicting...";

			try {
				const rawInputTensor = getRawInput();
				const processedInput = preprocess(rawInputTensor);
				const { INPUT_DIM } = NORM_CONSTANTS[currentTask];

				const inputTensor = new ort.Tensor('float32', processedInput, [1, INPUT_DIM]);
				const results = await session.run({ input1: inputTensor });
				const outputData = results.output1.data;

				displayResult(outputData);
			} catch (e) {
				loadingDiv.innerHTML = `<span class="text-red-600">Inference Error:</span> ${e.message}`;
			}
		}

		function getRawInput() {
			const featureDefs = currentTask === 'CLASSIFICATION' ? CLASSIFICATION_FEATURES : REGRESSION_CORE_FEATURES;
			const rawInputs = {};
			featureDefs.forEach(f => rawInputs[f.id] = parseFloat(document.getElementById(f.id).value));

			if (currentTask === 'CLASSIFICATION') {
				return new Float32Array([
					rawInputs.block, rawInputs.primaryType, rawInputs.locationDesc, rawInputs.domestic, rawInputs.beat,
					rawInputs.district, rawInputs.ward, rawInputs.communityArea, rawInputs.fbiCode, rawInputs.year,
					rawInputs.latitude, rawInputs.longitude, rawInputs.hour, rawInputs.day, rawInputs.month
				]);
			} else {
				const fullInput = new Float32Array(55).fill(0);
				fullInput[0] = rawInputs.day; fullInput[1] = rawInputs.month; fullInput[2] = rawInputs.year;
				fullInput[3] = rawInputs.latitude; fullInput[4] = rawInputs.longitude;
				const wardIndex = rawInputs.ward;
				if (wardIndex >= 1 && wardIndex <= 50) fullInput[4 + wardIndex] = 1.0;
				return fullInput;
			}
		}

		function preprocess(raw) {
			const { INPUT_DIM, X_MEANS, X_DEVIATIONS } = NORM_CONSTANTS[currentTask];
			const processed = new Float32Array(INPUT_DIM);
			for (let i = 0; i < INPUT_DIM; i++) processed[i] = (raw[i] - X_MEANS[i]) / X_DEVIATIONS[i];
			return processed;
		}

		function displayResult(outputData) {
			const loadingDiv = document.getElementById('loading');
			const outputDiv = document.getElementById('output');
			const resultText = document.getElementById('resultText');
			const confidenceDiv = document.getElementById('confidence');

			loadingDiv.classList.add('hidden');
			outputDiv.classList.remove('hidden');

			if (currentTask === 'CLASSIFICATION') {
				const [probNo, probYes] = outputData;
				const isArrest = probYes > probNo;
				resultText.innerHTML = isArrest
					? `<span class="text-red-600"><i class="fa-solid fa-handcuffs"></i> Arrest Likely</span>`
					: `<span class="text-green-600"><i class="fa-regular fa-face-smile"></i> Arrest Unlikely</span>`;
				confidenceDiv.textContent = `Probability: ${(probYes * 100).toFixed(1)}%`;
			} else {
				resultText.innerHTML = `<span class="text-indigo-600">${Math.round(outputData[0])} Crimes</span>`;
				confidenceDiv.textContent = `Raw value: ${outputData[0].toFixed(2)}`;
			}
		}

		// --- CENSUS MODEL LOGIC ---
		const CENSUS_DICTS = {
			workclass: ["Private", "Local-gov", "?", "Self-emp-not-inc", "Federal-gov", "State-gov", "Self-emp-inc", "Without-pay", "Never-worked"],
			education: ["11th", "HS-grad", "Assoc-acdm", "Some-college", "10th", "Prof-school", "7th-8th", "Bachelors", "Masters", "Doctorate", "5th-6th", "Assoc-voc", "9th", "12th", "1st-4th", "Preschool"],
			marital_status: ["Never-married", "Married-civ-spouse", "Widowed", "Divorced", "Separated", "Married-spouse-absent", "Married-AF-spouse"],
			occupation: ["Machine-op-inspct", "Farming-fishing", "Protective-serv", "?", "Other-service", "Prof-specialty", "Craft-repair", "Adm-clerical", "Exec-managerial", "Tech-support", "Sales", "Priv-house-serv", "Transport-moving", "Handlers-cleaners", "Armed-Forces"],
			relationship: ["Own-child", "Husband", "Not-in-family", "Unmarried", "Wife", "Other-relative"],
			race: ["Black", "White", "Asian-Pac-Islander", "Other", "Amer-Indian-Eskimo"],
			gender: ["Male", "Female"],
			native_country: ["United-States", "?", "Peru", "Guatemala", "Mexico", "Dominican-Republic", "Ireland", "Germany", "Philippines", "Thailand", "Haiti", "El-Salvador", "Puerto-Rico", "Vietnam", "South", "Columbia", "Japan", "India", "Cambodia", "Poland", "Laos", "England", "Cuba", "Taiwan", "Italy", "Canada", "Portugal", "China", "Nicaragua", "Honduras", "Iran", "Scotland", "Jamaica", "Ecuador", "Yugoslavia", "Hungary", "Hong", "Greece", "Trinadad&Tobago", "Outlying-US(Guam-USVI-etc)", "France", "Holand-Netherlands"]
		};

		function populateCensusDropdowns() {
			for (const [key, values] of Object.entries(CENSUS_DICTS)) {
				const select = document.getElementById(`census-${key}`);
				if (select) {
					select.innerHTML = values.map((v, i) => `<option value="${i}">${v}</option>`).join('');
				}
			}
		}

		async function runCensusPrediction() {
			const resultDiv = document.getElementById('census-result');
			resultDiv.classList.add('hidden');

			const inputData = new Float32Array(15).fill(0);
			inputData[0] = parseFloat(document.getElementById('census-age').value);
			inputData[1] = parseFloat(document.getElementById('census-workclass').value);
			inputData[2] = parseFloat(document.getElementById('census-education').value);
			inputData[3] = parseFloat(document.getElementById('census-marital_status').value);
			inputData[4] = parseFloat(document.getElementById('census-occupation').value);
			inputData[5] = parseFloat(document.getElementById('census-relationship').value);
			inputData[6] = parseFloat(document.getElementById('census-race').value);
			inputData[7] = parseFloat(document.getElementById('census-gender').value);
			inputData[8] = parseFloat(document.getElementById('census-capital_gain').value);
			inputData[9] = parseFloat(document.getElementById('census-capital_loss').value);
			inputData[10] = parseFloat(document.getElementById('census-hours').value);
			inputData[11] = parseFloat(document.getElementById('census-native_country').value);

			try {
				// FIXED PATH: ../static/models/naive_bayes.onnx instead of app/static/models/
				const session = await ort.InferenceSession.create('../static/models/naive_bayes.onnx');
				const tensor = new ort.Tensor('float32', inputData, [1, 15]);
				const results = await session.run({ float_input: tensor });

				const label = results.output_label.data[0];

				resultDiv.innerHTML = `Prediction: <span class="font-bold text-indigo-600">${label === 1 ? '>50K' : '<=50K'}</span>`;
				resultDiv.classList.remove('hidden');

			} catch (e) {
				console.error(e);
				resultDiv.innerHTML = `<span class="text-red-600">Error: ${e.message}</span>`;
				resultDiv.classList.remove('hidden');
			}
		}

		// Initialize
		document.addEventListener('DOMContentLoaded', () => {
			if (typeof ort === 'undefined') {
				console.error("ONNX Runtime not loaded");
				return;
			}
			updatePredictionType();
			populateCensusDropdowns();
		});

	</script>
</body>

</html>